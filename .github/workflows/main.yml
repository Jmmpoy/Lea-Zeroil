name: Generate versioned footer.js

on:
  push:
    branches: [main]

jobs:
  generate-footer:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Generate versioned footer.js
        run: |
          VERSION=$(date +%Y%m%d%H%M%S)
          mkdir -p public/generated

          echo "<!-- Généré automatiquement : $VERSION -->" > public/generated/footer.js

          # CSS globaux
          echo "<link rel='stylesheet' href='/base.css?v=$VERSION'>" >> public/generated/footer.js
          echo "<link rel='stylesheet' href='/components.css?v=$VERSION'>" >> public/generated/footer.js
          echo "<link rel='stylesheet' href='/footer.css?v=$VERSION'>" >> public/generated/footer.js
          echo "<link rel='stylesheet' href='/header.css?v=$VERSION'>" >> public/generated/footer.js
          echo "<link rel='stylesheet' href='/variables.css?v=$VERSION'>" >> public/generated/footer.js

          # JS global
          echo "<script src='/footer.js?v=$VERSION' defer></script>" >> public/generated/footer.js

          # Exemple de fichiers dans des dossiers (tu peux en ajouter d'autres)
          echo "<link rel='stylesheet' href='/Homepage/style.css?v=$VERSION'>" >> public/generated/footer.js
          echo "<script src='/Homepage/script.js?v=$VERSION' defer></script>" >> public/generated/footer.js
          echo "<script src='/Galerie-Oasis/gallery.js?v=$VERSION' defer></script>" >> public/generated/footer.js

      - name: Commit and push
        uses: EndBug/add-and-commit@v9
        with:
          add: 'public/generated/footer.js'
          message: 'Génération auto de footer.js avec version'
          push: true