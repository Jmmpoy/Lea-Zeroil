name: Purge jsDelivr cache on push

on:
  push:
    branches: [main]

# Pas de permissions sp√©ciales : on ne fait que purge (GET) et plus de push

jobs:
  purge-jsdelivr:
    runs-on: ubuntu-latest
    if: github.actor != 'github-actions[bot]'
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Purge jsDelivr cache for Lea-Zeroil assets
        run: |
          # Extraire les URLs gh/Jmmpoy/Lea-Zeroil depuis footer.js (sans query string)
          grep -oE 'https://cdn\.jsdelivr\.net/gh/Jmmpoy/Lea-Zeroil@main/[^"?#]+' footer.js | sort -u | while read -r url; do
            purge_url="${url/https:\/\/cdn./https://purge.}"
            echo "Purging: $purge_url"
            curl -s -o /dev/null -w "%{http_code}" "$purge_url" && echo " OK" || echo " (purge requested)"
          done
